<div class="customer-card">
  <div class="customer-avatar">
    <img [src]="userInfo.profile_image_url || 'assets/images/avatar.jpeg'" 
         [alt]="userInfo.name + ' avatar'"
         class="avatar" />
  </div>
  
  <div class="customer-info">
    <h3 class="customer-name">{{ userInfo.name }}</h3>
    <!-- <p class="customer-status">Cliente frecuente</p> -->
  </div>
  
  @if (userInfo.business_points?.has_active_deal) {
     <div class="stamps-container">
       <div class="stamp"
            *ngFor="let stamp of stamps()"
            [class.collected]="stamp.collected">
         <img [src]="'assets/logo/fidely-logo.png'"
              [alt]="'Sello ' + stamp.id"
              [class.grayscale]="!stamp.collected" />
       </div>
     </div>

     <!-- Stamp Counter -->
     <div class="stamp-counter">
       <span class="counter-text">
         {{ userInfo.business_points!.available_points }}/{{ userInfo.business_points!.required_points }} sellos
       </span>
     </div>
   } @else {
     <!-- No Active Deal Message -->
     <div class="no-deal-message">
       <p class="message-text">Para que el cliente pueda acumular sellos, primero debe hacer un trato.</p>
       <p class="message-subtitle">Haga clic en "Hagamos un trato" para comenzar.</p>
     </div>
   }
  
  <!-- Prize Info -->
    <div class="prize-info">
      @if (!userInfo.business_points?.has_active_deal) {
        <p class="info-text">No hay deal activo. Cree un deal para comenzar a sellar.</p>
      } @else if ((userInfo.business_points!.available_points || 0) < userInfo.business_points!.required_points) {
        <p class="info-text">Debe completar {{ userInfo.business_points!.required_points }} sellos para reclamar el premio.</p>
      } @else {
        <p class="info-text success">¡Premio disponible!</p>
      }
    </div>
</div>

<!-- Botones de acción -->
<div class="action-buttons">
  <app-button-code
    label="¡SELLAR TARJETA DE VISITA!"
    placeholder="Ingrese código de cliente"
    buttonColor="var(--color-primary)"
    textColor="white"
    inputColor="var(--color-primary)"
    fontSize="0.875rem"
    padding="1.5rem 2rem"
    borderRadius="12px"
    [disabled]="isStampButtonDisabled()"
    (onCodeSubmit)="onStampCard($event)"
  >
  </app-button-code>

  <button
    class="deliver-reward-button"
    [disabled]="!isPrizeAvailable()"
    (click)="onDeliverReward()"
    [ngStyle]="{
      'background-color': isPrizeAvailable() ? 'var(--color-secondary)' : '#cccccc',
      'color': 'white',
      'font-size': '0.875rem',
      'padding': '1.5rem 2rem',
      'border-radius': '12px',
      'border': 'none',
      'cursor': isPrizeAvailable() ? 'pointer' : 'not-allowed',
      'width': '100%',
      'font-weight': 'bold',
      'transition': 'all 0.3s ease'
    }"
  >
    ¡ENTREGAR PREMIO!
  </button>
</div>

<!-- Botón de Deal -->
<div class="deal-button-container">
  <button
    class="deal-button"
    [disabled]="isDealButtonDisabled()"
    (click)="onMakeDeal()"
    [ngStyle]="{
      'background-color': isDealButtonDisabled() ? '#cccccc' : 'var(--color-primary-dark)',
      'color': isDealButtonDisabled() ? '#666666' : 'var(--text-quaternary)',
      'font-size': '0.875rem',
      'padding': '1.5rem 2rem',
      'border-radius': '12px',
      'border': 'none',
      'cursor': isDealButtonDisabled() ? 'not-allowed' : 'pointer',
      'width': '100%',
      'font-weight': 'bold',
      'transition': 'all 0.3s ease',
      'display': 'flex',
      'align-items': 'center',
      'justify-content': 'center',
      'gap': '0.5rem'
    }"
  >
    <fa-icon [icon]="faHandshake"></fa-icon>
    HAGAMOS UN TRATO
  </button>
</div>

<!-- Deal Modal -->
<app-deal-modal
  #dealModal
  (dealCreated)="onDealCreated()"
  (modalClosed)="onDealModalClosed()"
></app-deal-modal>